<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>ClojureScript-in-ClojureScript</title>

	<meta name="description" content="ClojureScript-in-ClojureScript Presentation">
	<meta name="author" content="Joel Martin @bus_kanaka github@martintribe.org" />
	<meta name="viewport" content="width=device-width, maximum-scale=1.0, initial-scale=1.0, user-scalable=yes" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

        <!-- Google Fonts -->
        <link href='Quicksand.css' rel='stylesheet' type='text/css'>

        <!-- style and animations -->
        <link href="basic-animations.min.css" rel="stylesheet" type="text/css" />
        <link href="style1.css" rel="stylesheet" type="text/css" />
	<link href="style2.css" rel="stylesheet" type="text/css" />
	<link href="sticker.css" rel="stylesheet" type="text/css" />
	<link href="inc-clojure-brush/demo/shCoreDefault.css" rel="stylesheet" type="text/css" />
	<!--<link href="shCoreRDark.css" rel="stylesheet" type="text/css" /> -->
	<link href="shClojureMine.css" rel="stylesheet" type="text/css" />

        <script type="text/javascript" src="jquery-1.7.1.min.js"></script>
        <script>
            if (window.location.search.search("simple") < 0) {
                document.write('<script src="jmpress.all.min.js" type="text/javascript"><\/script>');
            }
        </script>
</head>
<body>

<div id="simple">

    <div id="home" class="step"
        data-x="0" data-y="0" data-scale="1000">

            <div style="width:100%; height: 100%;
                        text-align: center; margin-top: 134px;">
                <img height="300" src="imgs/CinC-logo.png">
            </div>

	</div>

        <!-- *************************************************************** -->

        <!-- About Me -->
        <div id="about-me"
            class="step slide" data-x="0" data-y="0" data-scale="8" data-rotate="180">
            <div class="cljs-in-cljs-logo">
                <div class="sticker">
                    <div class="title">
                        <p class="hello">HELLO</h1>
                        <p class="name">my name is</p>
                    </div> 
                    <div class="text"> 
                        <p class="written">Joel Martin</p> 
                    </div>
                </div>
            </div>

            <h1>About Me</h1>

            <!-- TODO: somewhere else -->
            <!--
            <a href="globe/" onclick="javascript:window.open('globe'); return false;" target="60s-window">Joel Martin in 60 seconds</a>
            -->

            <p data-jmpress="fade">Principal Software Engineer at LonoCloud</p>
            <p data-jmpress="fade">Probably best known for creating <a href="https://github.com/kanaka/noVNC">noVNC</a> and <a href="https://github.com/kanaka/websockify">websockify</a>

            <!-- TODO: At LonoCloud logo -->

            <div data-jmpress="fade">
                <h3>Links:</h3>
                <ul>
                    <li><a target="twitter1" href="https://twitter.com/#!/bus_kanaka">@bus_kanaka</a>
                    <li><a target="twitter2" href="https://twitter.com/#!/noVNC">@noVNC</a> (noVNC &amp; HTML5 related)
                    <li><a target="github" href="https://github.com/kanaka">github.com/kanaka</a>
                    <li><a target="blog" href="http://blog.n01se.net/kanaka">blog.n01se.net/kanaka</a>
                    <li><a href="mailto:cljs@martintribe.org">cljs@martintribe.org</a>
                </ul>
            </div>
        </div>

        <!-- Intro -->
        <div id="intro" class="step slide"
            data-x="-74000" data-y="-36000" data-scale="22" data-rotate="-45"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>Introducing ClojureScript-in-ClojureScript</h2>

            <p data-jmpress="fade">
            A Port of ClojureScript to ClojureScript
            </p>
            <p data-jmpress="fade">
            More specifically: A port of the Clojure parts of the ClojureScript compiler to ClojureScript.
            </p>

            <a data-jmpress="fade" href="https://github.com/kanaka/clojurescript">https://github.com/kanaka/clojurescript</a>

        </div>

        <!-- Why? -->
        <div id="why" class="step slide"
            data-x="-77000" data-y="-33000" data-scale="5" data-rotate="-45"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>Why?</h2>

            <p data-jmpress="fade">Best reason I can a give is to show
            examples of what is possible</p>
            
            <ul>
                <!--
                TODO: switch back to clojurescript.net
                <li data-jmpress="fade">Online web REPL: <a target="clojurescript-net" href="http://clojurescript.net">ClojureScript.net</a>
                -->
                <li data-jmpress="fade">Online web REPL: <a target="clojurescript-net" href="http://localhost:7080/web/repl3.html">ClojureScript.net</a>

                <!-- NOTES:
                - Let's try something easy:
                    (+ 1 1)

                - Something a bit more interesting:
                    (defn frob [x] (apply + 1 (vals (meta x))))
                    (frob (with-meta [1 2 3] {:a 10 :b 20 :c 30}))

                - Still pretty tame, let's take this up a notch:
                    (defmacro lazy-cat [& colls] `(concat ~@(map #(list `lazy-seq %) colls)))
                    
                    ; From here: http://clojurefun.wordpress.com/2012/08/31/side-effects-at-ends-of-sequences/
                    (defmacro surprise-ending [s f] `(lazy-cat ~s (do ~f nil)))

                    (def things (surprise-ending [1 2 3] (println "SURPRISE!"))) nil  ; *** NOTE *** nil
                    
                    - Cljs-in-Cljs doesn't yet have real Vars, so the nil supresses printing of the value of things

                    (take 2 things)
                    (take 3 things)
                    (take 4 things)
                    (take 4 things)

                    - I have to give credit for that little gem to Mike Anderson.
                -->
                <li data-jmpress="fade">Debug Web REPL for ClojureScript Projects: <a target="gol-example" href="game-of-life.html">ClojureScript Game of Life</a>

                <li data-jmpress="fade">HTML Script tags with ClojureScript: <a target="scriptany-example" href="scriptany-cljs1.html">Scriptany Example</a>

                <li data-jmpress="fade">ClojureScript REPL (Node.js)
                <ul data-jmpress="fade">
                    <li><code>./run.js repl-out/noderepl.js</code>
                </ul>

                <li data-jmpress="fade">ClojureScript shebang scripts (Node.js)
                <ul data-jmpress="fade">
                    <li><code>time ./shebang.cljs</code>
                    <li><code>time ./shebang.clj</code>
                </ul>

                <li data-jmpress="fade">ClojureScript-in-ClojureScript compiler (Node.js)
                <ul data-jmpress="fade">
                    <li><code>mkdir -p out2/cljs</code>
                    <li><code>cp out/goog.js out2/</code>
                    <li><code>cp out/cljs/core.cljs # Hack alert</code>
                    <li><code>./run.js out/cljsc.js hello.cljs &gt; hello.js</code>
                    <li><code>./run2.js hello.cljs</code>
                </ul>
            </ul>
        </div>

        <!-- Clojure-in-Clojure -->
        <div id="clj-in-clj" class="step slide"
            data-x="-71000" data-y="-39000" data-scale="5" data-rotate="-45"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>Clojure-in-Clojure</h2>
            <!-- What about Clojure-in-Clojure?
                 NOTES: Good question -->

            <!-- TODO: validate correctness -->
            <ul>
                <li data-jmpress="fade">The dream of Clojure-in-Clojure is
                a Clojure implementation that is written entirely in
                Clojure except for a very small platform specific
                core.
                <li data-jmpress="fade">It would allow easy porting to
                new platforms (among other advantages).
                <li data-jmpress="fade">ClojureScript itself is a step
                towards this goal; more of the compiler is implemented in
                Clojure.
                <li data-jmpress="fade">ClojureScript-in-ClojureScript is
                another step towards that goal; more of the compiler is
                implemented in Clojure/ClojureScript.
            </ul>
        </div>

        <!-- WAT -->
        <div id="wat" class="step slide"
            data-x="-71000" data-y="-33000" data-scale="5" data-rotate="-45"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>WAT</h2>

            <!-- TODO: complete this -->

            <p data-jmpress="fade">Aspects of a language that make you go</p>
            <p data-jmpress="fade">WAT!</p>

            <!-- TODO: add WAT image -->

            <p class="slide-content" data-jmpress="fade">Gary
            Bernhardt coined the term as part of an awesome lighting
            talk on WAT in ruby and JavaScript. You owe it to Check it
            out if you haven't already</p>

            <p class="slide-content" data-jmpress="fade">But wait,
            this is a talk about ClojureScript-in-ClojureScript ...</p>

        </div>

        <!-- WAT explain -->
        <div id="wat-explain" class="step slide"
            data-x="-70200" data-y="-34500" data-scale="0.5" data-rotate="45"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>Why WAT?</h2>

            <p class="slide-content" data-jmpress="fade">WAT shows
            where the bodies are burried: things done just to make it
            work (or to make it fast)</p>
            <p class="slide-content" data-jmpress="fade">WAT often
            reveals gaps and conflicts of the conceptual domains in
            a language</p>
            <p class="slide-content" data-jmpress="fade">Those strange
            language details revealed by WAT, usually reflect the
            areas that are difficult to port.</p>
            <p class="slide-content" data-jmpress="fade">Lest you
            think WAT can be completely avoided, let me propose the
            following:</p>
            <ul>
                <li class="slide-content" data-jmpress="fade">Joel's Law of
                Languages: The amount of WAT in a language is proportional
                to the influence of its community's pragmatists.

                <!-- TODO: check spelling -->
                <li class="slide-content" data-jmpress="fade">Corellary:
                The closer a language is to perfection, the less useful it is
                outside of academia.
            </ul>
            <p class="slide-content" data-jmpress="fade">So, let's
            take a quick trip into Clojure WAT.</p>
        </div>


        <!-- WAT classic -->
        <div id="wat-classic" class="step slide"
            data-x="-71750" data-y="-31750" data-scale="1" data-rotate="-45"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>Clojure WAT Classics</h2>

            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
user=> (contains? [1 2 3] 3)
false
            </code>
            </div>
            <!-- NOTES: anybody who has used Clojure for a while has
            discovered that [1 2 3] doesn't contain 3 -->
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
user=> (contains? [1 2 3] 0)
true
            </code>
            </div>
            <!-- NOTES: but of course it does contain 0 -->
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
user=> (false? false)
true
            </code>
            </div>
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
user=> (class (Boolean. false))
java.lang.Boolean
            </code>
            </div>
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
user=> (class false)
java.lang.Boolean
            </code>
            </div>
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
user=> (true? (Boolean. false))
false
            </code>
            </div>
            <!-- NOTES: for that matter it's not true either -->
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
user=> (false? (Boolean. false))
            </code>
            </div>
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
false  ; WAT
            </code>
            </div>
        </div>

        <!-- WAT update-in -->
        <div id="wat-update-in" class="step slide"
            data-x="-71050" data-y="-32450" data-scale="1" data-rotate="-45"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>(update-in WAT)</h2>

            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
user=> (get-in {:k :v} [:k])
:v
            </code>
            </div>
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
user=> (update-in {:k :v} [:k] (constantly :x))
{:k :x}
            </code>
            </div>
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
user=> (get-in {:k :v} [])
            </code>
            </div>
            <!-- NOTES: Logically, you get the root value -->
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
{:k :x}
            </code>
            </div>
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
user=> (update-in {:k :v} [] (constantly {:k :x}))
            </code>
            </div>
            <!-- NOTES: and if you update-in at the root -->
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
{nil {:k :x}, :k :v}  ; WAT
            </code>
            </div>
            <!-- NOTES: Which leads to the logical next step: -->
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
user=> ((update-in {:k :v} [] (constantly {:k :x})) nil)
{:k :x}
            </code>
            </div>

            <!-- TODO: WAT image -->
        </div>

        <!-- WAT reader -->
        <div id="wat-reader" class="step slide"
            data-x="-70350" data-y="-33150" data-scale="1" data-rotate="-45"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>Reading some WAT</h2>

            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
user=> (list #_anything-you-want)
()
            </code>
            </div>
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
user=> #_stop
            </code>
            </div>
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
... ; hung until next week
            </code>
            </div>
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
... :week
:week
user=>
            </code>
            </div>
            <!-- NOTES: that's pretty mundane, perhaps not reaching
            true WATness -->
            <!-- NOTES: but now let's talk about some magical things
            you can do with the reader -->
            <div class="clj-code" data-jmpress="fade">
            <p>Perl of wisdom: if you let the camel's nose in the tent ...</p>
            <code class="brush: clojure; gutter: false;">
user=> (defn $[x]x)
#'user/$
            </code>
            </div>
            <!-- NOTES: for one, you probably don't need as much
            whitespace as you think -->
            <div class="clj-code" data-jmpress="fade">
            <p>... soon you'' have the whole camel</p>
            <code class="brush: clojure; gutter: false;">
user=> (#^{#",/\/P"$}#(@#'$`~%)$)
#&lt;user$$ user$$@359ecd80>
            </code>
            </div>
            <!-- in fact, you can do a whole lot of nothing without
            any whitespace -->

            <!-- TODO: WAT image -->
        </div>

        <!-- WAT random -->
        <div id="wat-random" class="step slide"
            data-x="-69650" data-y="-33850" data-scale="1" data-rotate="-45"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>Schrodinger's WAT</h2>

            <div class="clj-code">
            <code class="brush: clojure; gutter: false;">
(defrecord Cat [])
(defprotocol Wat (observe [x]))
            </code>
            </div>
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
(import [clojure.lang IObj IRecord])
(extend-protocol Wat IObj (observe [_] :dead)
                     IRecord (observe [_] :alive))
            </code>
            </div>
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
(println (observe (Cat.)))
:dead
            </code>
            </div>
            <!-- NOTES: save it to a file and run it a bunch of times -->
            <p data-jmpress="fade">Rinse (the cat) and repeat</p>
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
:dead
:dead
:dead
:dead
:alive ; mostly dead, but occasionally alive, YMMV
:dead
:dead
            </code>
            </div>

            <!-- TODO: WAT image -->
        </div>

        <!-- WAT namespaces -->
        <div id="wat-namespaces" class="step slide"
            data-x="-71250" data-y="-31250" data-scale="1" data-rotate="-45"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>Muddling through namespaces</h2>

            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
user=> (class *ns*)
clojure.lang.Namespace
            </code>
            </div>
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
user=> @*ns*
ClassCastException ...
            </code>
            </div>
            <p data-jmpress="fade">Namespaces are not a ref type.
            Immutable then?</a>
            <!-- NOTES: so naturally, sinc it's not a ref type, we
            should conclude that such a core data-structure in Clojure
            would be an immutable persistent data structure. Let's
            check. -->
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
user=> (hash *ns*)
1364844884
            </code>
            </div>
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
user=> (count (ns-publics *ns*))
0
            </code>
            </div>
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
user=> (def life 42)
user=> (count (ns-publics *ns*))
1
            </code>
            </div>
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
user=> (hash *ns*)
1364844884  ; same hash, new life
            </code>
            </div>
            <!-- NOTES: the same hash. It's magic global mutable state
            ... WAT -->

            <!-- TODO: WAT image -->
        </div>

        <!-- WAT macros 1 -->
        <div id="wat-macros1" class="step slide"
            data-x="-70550" data-y="-31950" data-scale="1" data-rotate="-45"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>Rule #1: never talk about macros</h2>
            <!-- Let's talk about macros -->

            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
user=> (and :a-one :and :a-two)
:a-two
            </code>
            </div>
            <!-- NOTES: and is a very convenient little macro. So
            let's use it on a sequence. -->
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
user=> (apply and [:a-one :two :three :four])
CompilerException ... Can't take value of a macro ...
            </code>
            </div>
            <!-- NOTES: WAT! Okay, fine, macros lack composability.
            Let's move on and talk about macros -->
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
user=> (defmacro baz [x] (* 2 x))
#'user/baz
            </code>
            </div>
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
user=> (class #'baz)
clojure.lang.Var
            </code>
            </div>
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
user=> (class @#'baz)
user$baz
            </code>
            </div>
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
user=> (baz 2)
4
            </code>
            </div>
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
user=> (#'baz 2)
            </code>
            </div>
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
ArityException Wrong number of args (1) ...
            </code>
            </div>
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
user=> (@#'baz 2)
            </code>
            </div>
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
ArityException Wrong number of args (1) ...
            </code>
            </div>

        </div>

        <!-- WAT macros 2 -->
        <div id="wat-macros2" class="step slide"
            data-x="-69850" data-y="-32650" data-scale="1" data-rotate="-45"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>Rule #2: never talk about macros</h2>
            <!-- Let's talk about macros -->

            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
user=> (let [foo (defmacro bar [x] (* 2 x))] (foo 1.1))
            </code>
            </div>
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
ArityException Wrong number of args (1) ...
            </code>
            </div>
            <!-- NOTES: as you might have guessed from the previous
            discussion of macro/var interaction ... -->
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
user=> (let [foo (defmacro bar [x] (* 2 x))] (bar 1.1))
            </code>
            </div>
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
2.2  ; these aren't the droids you're looking for
            </code>
            </div>
            <p data-jmpress="fade">Again for good measure</p>
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
user=> (let [baz (defmacro qux [x] (* 2 x))] (qux 21))
            </code>
            </div>
            <div class="clj-code" id="qux1" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
ArityException Wrong number of args (1) ...
            </code>
            </div>
            <!-- WAT! -->
            <p data-jmpress="fade after 10ms #qux1">WAT</p>
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
user=> (let [baz (defmacro qux [x] (* 2 x))] (qux 21))
            </code>
            </div>
            <div class="clj-code" data-jmpress="fade">
            <code class="brush: clojure; gutter: false;">
42  ; life, the universe and everything
            </code>
            </div>
            <!-- more WAT! -->

            <!-- TODO: WAT image -->
        </div>


        <!-- Porting Steps -->
        <div id="porting" class="step slide"
            data-x="78000" data-y="40000" data-scale="22" data-rotate="135"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>Porting Steps</h2>

            <p data-jmpress="fade">A chronological rather than
            functional overview of the process.</p>
        </div>

        <!-- ClojureScript Compilation Process -->
        <div id="eval" class="step slide"
            data-x="71000" data-y="43000" data-scale="4" data-rotate="225"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>Review: ClojureScript Compilation Process</h2>

            <!-- NOTES: before talking about the actual steps, let's
            do a quick review of the ClojureScript compilation process
            -->
            <ul>
                <li data-jmpress="fade">Read
                <ul data-jmpress="fade">
                    <li>symbols, comments, quote, metadata, syntax quote and unquote
                    <li>literals: characters, maps, lists, vectors, keywords, strings
                    <li data-jmpress="fade">dispatch reader (#...)
                    <ul>
                        <li>literals: sets, regex, anonymous functions
                        <li>discard/ignore, quoted vars
                    </ul>
                </ul>
                <!-- NOTES: as we saw earlier, reader macros are often
                self-deliminated but I recommend not skipping the
                whitespaces in real code. -->
                <li data-jmpress="fade">Analyze
                <ul>
                    <li data-jmpress="fade">specials expansion/parsing
                    (def, fn*, if, let*, recur, etc)
                    <li data-jmpress="fade">macro expansion/parsing
                    <li data-jmpress="fade">regular form parsing
                </ul>
                <li data-jmpress="fade">Compile/emit
                <ul>
                    <li data-jmpress="fade">call analyzer to build AST
                    <li data-jmpress="fade">resolve (compile or copy) dependencies
                    <ul>
                        <li>Closure lib, clojure.*, cljs.core, etc
                    </ul>
                    <li data-jmpress="fade">traverse AST emitting JavaScript
                    <li data-jmpress="fade">call Closure Compiler (optimize, merge)
                </ul>
                <li data-jmpress="fade"><hr> Eval
                <ul data-jmpress="fade">
                    <li>at JavaScript load time
                </ul>
            </ul>
        </div>


        <div id="porting1" class="step slide"
            data-x="84000" data-y="36000" data-scale="3" data-rotate="135"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>Step 1. Minimal web REPL</h2>

            <div class="slide-content">
                <p data-jmpress="fade">
                The beginning: a Clojure/conj hackathon with chouser.
                </p>

                <ul data-jmpress="fade">
                    <li>Copy src/clj/cljs/{compiler,analyzer}.clj to src/cljs/cljs/*.cljs
                    <li>Static snapshot of the analyzer namespaces atom.
                    <li>Move macros out and pull in using :use-macros
                    <li>Stub out a bunch of stuff
                    <!-- 
                    <li>Stub out file I/O
                    <li>Make macroexpand-1 a no-op
                    <li>Port clojure.lang.Compiler/munge
                    -->
                    <li>Rewrite emit-constant multimethods as EmitConstant
                    protoocol (ClojureScript protocol oriented rather than
                    type/class oriented).
                    <li>Bootstrap html/javascript file:
                    <ul>
                        <li>load the static namespaces snapshot
                        <li>setup the analyzer environment
                        <!-- TODO: build this for demo? -->
                    </ul>
                    <li><b>RESULT</b>:
                    <ul>
                        <li>very simple web REPL
                        <li>invoke cljs.core functions
                        <li>specials (fn*, if, def, let*)
                        <li>no macros (defn, let, etc)
                    </ul>
                </ul>
            </div>
        </div>

        <div id="porting2" class="step slide"
            data-x="82000" data-y="38000" data-scale="3" data-rotate="135"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>Step 2. Node.js REPL Support</h2>

            <div class="slide-content">
                <ul>
                    <li>Add Node.js file loading to Google Closure (goog.js)
                    <!-- The Closure library does not have support for
                    file-loading via Node.js so this stubs it in for when we
                    build into multiple files. -->
                    <li>node.js launch script (run.js):
                    <ul>
                        <li>load the static namespaces snapshot
                        <!-- <li>setup the analyzer environment -->
                        <li>provide a basic REPL using Node.js readline module.
                    </ul>
                    <li><b>RESULT</b>:
                    <ul>
                        <li>very simple Node.js REPL
                        <li>equivalent to the simple web REPL
                    </ul>
                </ul>
            </div>
        </div>

        <div id="porting3" class="step slide"
            data-x="80000" data-y="40000" data-scale="3" data-rotate="135"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>Step 3. Dynamic namespaces data</h2>

            <div class="slide-content">
                <ul>
                    <li>The namespaces atom: the analyzer's namespace
                    and var data for def forms being compiled.
                    <li>Lookup vars during compilation (only
                    macros are resolved to compiler's namespace vars).
                    <li>Normally discarded after compilation, but
                    cljs-in-cljs needs it!
                    <li>Old and busted:
                    <ul>
                        <li>Write entire namespaces content to a file
                        <!--
                        <li>Prune problematic namespaces data. E.g. the infamous "/"
                        -->
                        <!-- NOTES: / is used to delinate namespace
                        part of a symbol so / by itself is a bit of an
                        odd thing -->
                        <li>Manually add "(set! cljs.analyzer.namespaces DATA)"
                    </ul>
                    <li>New hotness (<b>RESULT</b>):
                    <ul>
                        <li>Emit namespaces data to end of each compiled file
                        <li>Just for the namespace being compiled
                        <li>Swapped into to build up the namespaces as
                        each file is loaded.
                </ul>
            </div>
        </div>

        <div id="porting4" class="step slide"
            data-x="78000" data-y="42000" data-scale="3" data-rotate="135"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>Step 4. Complete the reader</h2>

            <div class="slide-content">
                <ul>
                    <li>Port syntax quote/unqoute from Java code.
                    Syntax quote/unquote is a key component of macros.
                    <li>Port the anonymous function and function
                    argument reader
                    <li>Activate comment reader
                    <li><b>RESULT</b>:
                    <ul>
                        <li>Full reader (modulo bugs)
                    </ul>
                </ul>
            </div>
        </div>

        <div id="porting5" class="step slide"
            data-x="76000" data-y="44000" data-scale="3" data-rotate="135"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>Step 5. defmacro </h2>
            <ul>
                <li>defmacro is itself a macro. This leads to some
                challenges.
                <li>In ClojureScript, macros are defined on the
                Clojure/JVM side. Only the expanded result is emitted
                as JS code.
                <li>Port defmacro macro from into cljs-in-cljs
                core.cljs file.
                <li><b>RESULT</b>:
                <ul>
                    <li>Runtime definition of new macros.
                    <li>No ahead-of-time definition of macros due to
                    the split between the Clojure vars namespace and
                    the ClojureScript compiled namespaces.
                    <li>Still no predefined core macros.
                </ul>
            </ul>
        </div>

        <div id="porting6" class="step slide"
            data-x="74000" data-y="46000" data-scale="3" data-rotate="135"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>Step 6. clj-defmacro and core macros</h2>

            <div class="slide-content">
                <ul>
                    <li>Add clj-defmacro to core_macros.clj and pull it in using
                    :use-macros so that it is a Clojure (JVM) side version
                    of defmacro.
                    <li>Use clj-defmacro to port macros from Clojure core.clj and
                    ClojureScript core.cljs into cljs-in-cljs core.cljs file.
                    <!--
                    <li>Very little generally has to be done to port the macros,
                    however, there are some minor things:
                    <ul>
                        <li>Syntax quoted symbols must be fully qualified since
                        the reader at clj-defmacro time does not know how to
                        resolve the cljs side namespace (yet).
                        <li>Convert Java exceptions to Javascript exceptions.
                    </ul>
                    -->
                    <li>Port destructure function for use by let, loop, fn
                    macros.
                    <li><b>RESULT</b>:
                    <ul>
                        <li>Much of core Clojure is now available
                        <li>Starting to feel like a real REPL.
                    </ul>
                </ul>
            </div>
        </div>

        <div id="porting7" class="step slide"
            data-x="82000" data-y="34000" data-scale="3" data-rotate="135"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <div class="slide-content">
                <h2>Step 7. Types, protocols and first-class symbols</h2>

                <ul>
                    <li>Definiton and extension of protocols uses
                    metadata on symbols to pass around information.
                    <li>In ClojureScript, symbols are just prefixed
                    strings.
                    <li>Problem: no custom attributes on strings in
                    JS.
                    <!-- NOTES Technically: JS will coerce string to String
                    to add a property, and then immediately coerce
                    back to string, losing the property. -->
                    <li>Change symbols to real things that support
                    metadata.
                    <li>Port reify, extend-type, deftype, defrecord, and
                    defprotocol macros and supporting functions from
                    CloureScript core.clj. Port extend-protocol from
                    Clojure core.clj.
                    <li><b>RESULT</b>:
                    <ul>
                        <li>New types, protocols, records, etc can be
                        defined at "runtime" (more specifically at
                        cljs-in-cljs compile time).
                    </ul>

                </ul>
            </div>
        </div>

        <div id="porting8" class="step slide"
            data-x="80000" data-y="36000" data-scale="3" data-rotate="135"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>Step 8. Namespaces as a value </h2>

            <div class="slide-content">

                <ul>
                    <li>In Clojure, the *ns* symbol refers to the
                    mutable Namespace object of the current namespace.
                    <li>The namespaces data in ClojureScript is
                    a normal Clojure persistent datastructure in an
                    atom.
                    <li>Problem: modifying a namespace in the
                    namespaces data (via a def*) will not
                    automatically update the copy of it in *ns*.
                    <li>Drop *ns* for cljs-in-cljs and replace with
                    *ns-sym*: a dynamic "var" with the namespace symbol.
                    <li>Update *ns* uses to use *ns-sym* and deref
                    namespaces atom as appropriate.
                    <li>Port some namespace related functions
                    <li><b>RESULT</b>:
                    <ul>
                        <li>No stale *ns*.
                        <li>Namespace creation and other functions.
                        <li>More correct macro and symbol resolution.
                    </ul>
                </ul>
            </div>
        </div>

        <div id="porting9" class="step slide"
            data-x="78000" data-y="38000" data-scale="3" data-rotate="135"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>Step 9. File I/O Support </h2>

            <ul>
                <li>Implement Java-like File object.
                <li>Implement Java-like I/O readers/streams (maybe).
                <li>Move push-back-readerfrom reader.cljs to core.cljs
                <li>Use node.js file read/write. Use XMLHttpRequest for web
                file read.
                <li><b>RESULT</b>:
                <ul>
                    <li>load-file now works.
                    <li>Testing via direct cljs file loading rather than pasted forms.
                </ul>
            </ul>
        </div>

        <div id="porting10" class="step slide"
            data-x="76000" data-y="40000" data-scale="3" data-rotate="135"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>Step 10. Miscellaneous </h2>

            <div class="slide-content">
                <ul>
                    <li>Port defmulti and defmethod macros.
                    <li>Output "streams" (*out*, *err*, *rtn*)
                    <ul>
                        <li>Rendering functions rather than file streams
                        <li>*rtn* for rendering of return value
                    </ul>
                    <li>Port closure.clj
                    <li>Line numbering pushbackreader
                    <li>Bug fixes: / symbol, keywords, regexes, unicode, etc, etc
                    <li>Tests
                    <li>REPL functionality/cleanup
                </ul>
            </div>
        </div>

        <div id="porting11" class="step slide"
            data-x="74000" data-y="42000" data-scale="3" data-rotate="135"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>Step 11. Self-hosting (in-progress)</h2>

            <div data-jmpress="fade">
            Standard ClojureScript

            <div class="selfbox1">
                <div class="selfhost labels">
                    <div>
                        Input
                    </div>
                    <div>
                        Program
                    </div>
                    <div>
                        Runtime
                    </div>
                </div>

                <div class="selfhost">
                    <div class="input" data-jmpress="fade">
                        Program.cljs
                    </div>
                    <div class="program">
                        ClojureScript.clj
                    </div>
                    <div class="runtime java">
                        JVM
                    </div>
                </div>

                <div class="arrow" id="sh1" data-jmpress="fade">
                    <img height=40 src="imgs/arrow.png">
                </div>

                <div class="selfhost" data-jmpress="fade after 10ms #sh1">
                    <div class="input">
                        ---
                    </div>
                    <div class="program">
                        program.js
                    </div>
                    <div class="runtime">
                        Node.js/Browser
                    </div>
                </div>
            </div>
            </div>

            <!-- bin/cljsc hello.cljs &gt; hello.js -->

            <div  data-jmpress="fade">
            ClojureScript-in-ClojureScript

            <div class="selfbox1">
                <div class="selfhost labels">
                    <div>
                        Input
                    </div>
                    <div>
                        Program
                    </div>
                    <div>
                        Runtime
                    </div>
                </div>

                <div class="selfhost">
                    <div class="input" data-jmpress="fade">
                        ClojureScript.cljs
                    </div>
                    <div class="program">
                        ClojureScript.clj
                    </div>
                    <div class="runtime java">
                        JVM
                    </div>
                </div>

                <div class="arrow" id="sh2" data-jmpress="fade">
                    <img height=40 src="imgs/arrow.png">
                </div>


                <div class="selfhost" data-jmpress="fade after 10ms #sh2">
                    <div class="input" data-jmpress="fade">
                        Program.cljs
                    </div>
                    <div class="program">
                        ClojureScript.js
                    </div>
                    <div class="runtime">
                        Node.js/Browser
                    </div>
                </div>

                <div class="arrow" id="sh3" data-jmpress="fade">
                    <img height=40 src="imgs/arrow.png">
                </div>

                <div class="selfhost" data-jmpress="fade after 10ms #sh3">
                    <div class="input">
                        ---
                    </div>
                    <div class="program">
                        program.js
                    </div>
                    <div class="runtime">
                        Node.js/Browser
                    </div>
                </div>
            </div>
            </div>

            <!--
bin/cljsc src/cljs/cljsc.cljs &gt; cljsc.js
./run.js cljsc.js hello.cljs &gt; hello.js -->

            <div data-jmpress="fade">
            Self-hosted ClojureScript-in-ClojureScript

            <!-- NOTES: this is still in progress -->

            <div class="selfbox2">
                <div class="selfhost labels">
                    <div>
                        Input
                    </div>
                    <div>
                        Program
                    </div>
                    <div>
                        Runtime
                    </div>
                </div>

                <div class="selfhost">
                    <div class="input" data-jmpress="fade">
                        ClojureScript.cljs
                    </div>
                    <div class="program">
                        ClojureScript.clj
                    </div>
                    <div class="runtime java">
                        JVM
                    </div>
                </div>

                <div class="arrow" id="sh4" data-jmpress="fade">
                    <img height=40 src="imgs/arrow.png"><br>
                    1X
                </div>


                <div class="selfhost" data-jmpress="fade after 10ms #sh4">
                    <div class="input" data-jmpress="fade">
                        ClojureScript.cljs
                    </div>
                    <div class="program">
                        ClojureScript.js
                    </div>
                    <div class="runtime">
                        Node.js/Browser
                    </div>
                </div>

                <div class="arrow" id="sh5" data-jmpress="fade">
                    <img height=40 src="imgs/arrow.png">
                </div>

                <div class="selfhost" data-jmpress="fade after 10ms #sh5">
                    <div class="input" data-jmpress="fade">
                        Program.cljs
                    </div>
                    <div class="program">
                        ClojureScript.js
                    </div>
                    <div class="runtime">
                        Node.js/Browser
                    </div>
                </div>

                <div class="arrow" id="sh6" data-jmpress="fade">
                    <img height=40 src="imgs/arrow.png">
                </div>

                <div class="selfhost" data-jmpress="fade after 10ms #sh6">
                    <div class="input">
                        ---
                    </div>
                    <div class="program">
                        program.js
                    </div>
                    <div class="runtime">
                        Node.js/Browser
                    </div>
                </div>
            </div>
            </div>

        </div>



        <!-- Forms -->
        <div id="forms" class="step slide"
            data-x="-128000" data-y="-2000" data-scale="22" data-rotate="-45"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>Form Walkthroughs</h2>

        </div>

        <!-- Forms (+ 1 1) -->
        <div id="forms-plus" class="step slide"
            data-x="-132000" data-y="2000" data-scale="4" data-rotate="-45"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>(+ 1 1)</h2>

            <p data-jmpress="fade"></p>

        </div>

        <!-- Forms (fn* [] 5) -->
        <div id="forms-fnSTAR" class="step slide"
            data-x="-129000" data-y="-1000" data-scale="4" data-rotate="-45"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>(fn* [] 5) , ((fn* [] 5))</h2>

        </div>

        <!-- Forms (def foo 5) -->
        <div id="forms-def" class="step slide"
            data-x="-126000" data-y="-4000" data-scale="4" data-rotate="-45"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>(def foo 5)</h2>

        </div>

        <!-- Forms `(list 5 foo) -->
        <div id="forms-squote" class="step slide"
            data-x="-123000" data-y="-7000" data-scale="4" data-rotate="-45"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>(def 5 foo) , `(list 5 foo) , `(list 5 ~foo)</h2>
            <h2>#(list %) , (#(list %))</h2>


        </div>

        <!-- Forms (defn sqr [x] (* x x)) -->
        <div id="forms-defn" class="step slide"
            data-x="-130000" data-y="4000" data-scale="4" data-rotate="-45"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>(defn sqr [x] (* x x)) , sqr , (sqr 3)</h2>

            <p data-jmpresss="fade">Only first form is expanded at
            root of the AST. AST for the internal macro would have
            expanded form.</p>
        </div>

        <!-- Forms (and ...) -->
        <div id="forms-and-macro" class="step slide"
            data-x="-127000" data-y="1000" data-scale="4" data-rotate="-45"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>(and true false)</h2>

        </div>

        <!-- Forms (defmacro ...) -->
        <div id="forms-ns" class="step slide"
            data-x="-124000" data-y="-2000" data-scale="4" data-rotate="-45"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>(defmacro unless [pred a b] `(if (not ~pred) ~a ~b))</h2>
            <h2>(unless false :yep :nope)</h2>

            <p data-jmpresss="fade">When macro invoked it is passed
            form and env as first two args. That's why when you invoke
            the actual macro function (without having analyzer expand
            it first, you get invalid arity).</p>

        </div>

        <!-- Forms (ns cljs.myns) -->
        <div id="forms-ns" class="step slide"
            data-x="-121000" data-y="-5000" data-scale="4" data-rotate="-45"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>(ns cljs.myns)</h2>

        </div>

        <!-- finish -->
        <div id="finish" class="step slide"
            data-x="128000" data-y="15000" data-scale="22" data-rotate="135"
            style="padding-top: 5px;">

            <div class="cljs-in-cljs-logo">
                <img height="100" src="imgs/CinC-logo.png">
            </div>

            <h2>Finishing Up</h2>

            <h3>Links:</h3>
            <ul>
                <li>Project page: <a target="githubA" href="https://github.com/kanaka/clojurescript">github.com/kanaka/clojurescript</a>
                <li>Live online REPL: <a target="cljs.netA" href="http://clojurescript.net">clojurescript.net</a>
                <li>Major updates: <a target="twitterA" href="https://twitter.com/#!/bus_kanaka">@bus_kanaka</a>
                <li>#cljs-in-cljs (freenode)
            </ul>
        </div>

</div>

<div class="hint">
    <p>Use arrow keys to navigate</p>
</div>

<script type="text/javascript">
$(function() {
        $('#simple').jmpress({
                /*
                mouse: {
                    // Disable step mouse click
                    clickSelects: false
                },
                */
                viewPort: {
                    zoomBindMove: false
                }
            });
});

function load(target, href) {
    console.log("Loading: " + href);
    $(target)[0].src = href;
}

function unload(target) {
    $(target)[0].src = "";
}

</script>
<script type="text/javascript" src="inc-clojure-brush/demo/shCore.js"></script>
<script type="text/javascript" src="inc-clojure-brush/shBrushClojure.js"></script>
<script>
    SyntaxHighlighter.config.tagName = "code";
    SyntaxHighlighter.all();
</script>
</body>
</html>
